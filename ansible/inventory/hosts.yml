---
all:
  children:
    # SSH hosts use password authentication for initial provisioning only.
    # After Tailscale is installed, password and SSH key authentication are disabled.
    ssh_hosts:
      hosts:
        proxmox-ssh:
          ansible_host: 10.0.0.10
          ansible_user: root
        control-node-ssh:
          ansible_host: 10.0.0.11
          ansible_user: ubuntu
        worker-node-1-ssh:
          ansible_host: 10.0.0.12
          ansible_user: ubuntu
        worker-node-2-ssh:
          ansible_host: 10.0.0.13
          ansible_user: ubuntu
      vars:
        ansible_connection: ssh
        ansible_ssh_pass: "{{ lookup('amazon.aws.aws_ssm', '/homelab/root_password') }}"

    tailscale_hosts:
      hosts:
        proxmox-tailscale:
          ansible_host: 100.85.178.8
          ansible_user: root
        control-node-tailscale:
          ansible_host: 100.88.162.100
          ansible_user: ubuntu
        worker-node-1-tailscale:
          ansible_host: 100.68.97.68
          ansible_user: ubuntu
        worker-node-2-tailscale:
          ansible_host: 100.116.205.52
          ansible_user: ubuntu
      vars:
        ansible_connection: ssh

    # Hosts for k3s-ansible collection
    k3s_cluster:
      children:
        server:
          hosts:
            100.88.162.100:
        agent:
          hosts:
            100.68.97.68:
            100.116.205.52:
      vars:
        ansible_port: 22
        ansible_user: ubuntu
        k3s_version: v1.34.1+k3s1
        token: "{{ lookup('amazon.aws.aws_ssm', '/homelab/k3s_token') }}"
        api_endpoint: "{{ hostvars[groups['server'][0]]['ansible_host'] | default(groups['server'][0]) }}"
        api_port: 6443
